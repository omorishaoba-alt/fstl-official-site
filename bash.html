#!/bin/bash

# =============================================
# FSTL OSHOBE PWA Git + GitHub Pages Deployment
# =============================================
# Usage: ./deploy_fstl_oshobe_live.sh <GitHubRepoURL>
# Example: ./deploy_fstl_oshobe_live.sh https://github.com/YourUsername/FSTL-OSHOBE-PWA.git
# =============================================

if [ -z "$1" ]; then
    echo "ERROR: Please provide GitHub repository URL as first argument."
    echo "Usage: ./deploy_fstl_oshobe_live.sh <GitHubRepoURL>"
    exit 1
fi

GITHUB_REPO=$1

echo "Starting FSTL OSHOBE PWA deployment..."
echo "Repository: $GITHUB_REPO"

# Step 1: Initialize git if not already
if [ ! -d ".git" ]; then
    git init
    echo "Git repository initialized."
else
    echo "Git repository already exists."
fi

# Step 2: Stage all files
git add .
echo "All files staged."

# Step 3: Commit changes
git commit -m "FSTL OSHOBE PWA ready for deployment â€“ EXECUTE BLAST"
echo "Files committed."

# Step 4: Add remote repository
git remote remove origin 2>/dev/null
git remote add origin $GITHUB_REPO
echo "Remote origin set to $GITHUB_REPO"

# Step 5: Set main branch and push
git branch -M main
git push -u origin main
echo "Files pushed to GitHub."

# Step 6: Enable GitHub Pages using gh CLI
if ! command -v gh &> /dev/null
then
    echo "WARNING: GitHub CLI (gh) not installed. Install it for auto GitHub Pages deployment."
    echo "You can still enable GitHub Pages manually in repo settings."
else
    echo "Enabling GitHub Pages on main branch (root)..."
    gh repo view $GITHUB_REPO &> /dev/null
    gh api -X PUT repos/:owner/:repo/pages \
        -f source_branch=main \
        -f source_path="/" \
        -f cname="" &> /dev/null
    echo "GitHub Pages enabled. Your PWA should be live shortly."
fi

echo "Deployment complete. Visit https://<YourUsername>.github.io/<RepoName>/ to check your live PWA."